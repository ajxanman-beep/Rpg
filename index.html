<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Elemental RPG</title>
<style>
  body { margin: 0; overflow: hidden; background: #121212; font-family: Arial, sans-serif; color: white; }
  canvas { background: #87ceeb; display: block; }
  #element-selection {
    position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center;
  }
  #element-selection button {
    margin: 10px; padding: 15px 25px; font-size: 18px; border: none; border-radius: 5px; cursor: pointer;
  }
  .fire { background-color: #ff4500; color: #fff; }
  .water { background-color: #1e90ff; color: #fff; }
  .earth { background-color: #8b4513; color: #fff; }
  .air { background-color: #dcdcdc; color: #000; }
</style>
</head>
<body>

<div id="element-selection">
  <h1>Choose Your Element</h1>
  <button class="fire" onclick="chooseElement('Fire')">Fire</button>
  <button class="water" onclick="chooseElement('Water')">Water</button>
  <button class="earth" onclick="chooseElement('Earth')">Earth</button>
  <button class="air" onclick="chooseElement('Air')">Air</button>
</div>

<canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

function resizeCanvas() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

let keys = {};
document.addEventListener('keydown', e => keys[e.code] = true);
document.addEventListener('keyup', e => keys[e.code] = false);

let mouse = {x: 0, y: 0};
canvas.addEventListener('mousemove', e => { mouse.x = e.clientX; mouse.y = e.clientY; });

// Player
const player = {
  x: 50, y: 300, width: 50, height: 50, color: 'red',
  dx: 0, dy: 0, speed: 5, jumpForce: -12, onGround: false, element: null
};

// Platforms
let platforms = [];
function createPlatforms() {
  platforms = [];
  platforms.push({x: 0, y: canvas.height - 50, width: canvas.width, height: 50}); // ground
  platforms.push({x: 400, y: canvas.height - 150, width: 200, height: 20});
}
createPlatforms();
window.addEventListener('resize', createPlatforms);

let tempPlatforms = [];
let groundSpikes = [];
let fireballs = [];
let waterWaves = [];

// Dummy enemy
let dummy = { x: 700, y: canvas.height - 100, width: 50, height: 80, color: 'gray', health: 100, alive: true };

// Element selection
function chooseElement(element) {
  player.element = element;
  const colors = { Fire:'#ff4500', Water:'#1e90ff', Earth:'#8b4513', Air:'#dcdcdc' };
  player.color = colors[element] || 'red';
  document.getElementById('element-selection').style.display = 'none';
  player.x = 50; player.y = canvas.height - player.height - 50;
  update();
}

// Abilities
function useAbility() {
  if (!player.element) return;
  const dx = mouse.x - (player.x + player.width/2);
  const dy = mouse.y - (player.y + player.height/2);
  const dist = Math.sqrt(dx*dx + dy*dy);

  switch(player.element) {
    case 'Fire':
      fireballs.push({
        x: player.x + player.width/2,
        y: player.y + player.height/2,
        width: 15,
        height: 10,
        vx: dx / dist * 10,
        vy: dy / dist * 10
      });
      break;

    case 'Water':
      waterWaves.push({
        x: player.x + player.width/2,
        y: player.y + player.height/2,
        width: 40,
        height: 20,
        vx: dx / dist * 6,
        vy: dy / dist * 6,
        damage: 10
      });
      break;

    case 'Air':
      const dashDist = 100;
      player.x += dx / dist * dashDist;
      player.y += dy / dist * dashDist;
      break;
  }
}

// Earth spike (E key)
function useEarthSpike() {
  if(player.element !== 'Earth') return;
  const dx = mouse.x - (player.x + player.width/2);
  const dy = mouse.y - (player.y + player.height/2);
  const dist = Math.sqrt(dx*dx + dy*dy);
  const speed = 8;
  groundSpikes.push({
    x: player.x + player.width/2,
    y: player.y + player.height/2,
    width: 20,
    height: 20,
    vx: dx / dist * speed,
    vy: dy / dist * speed,
    timer: 200
  });
}

// Left click: spawn platform under player (Earth only)
canvas.addEventListener('click', e => {
  if(player.element === 'Earth'){
    tempPlatforms.push({x: player.x, y: player.y + player.height + 5, width: 100, height: 20, timer: 200});
  }
});

// Keybindings
document.addEventListener('keydown', e => {
  if(e.code==='KeyE') useEarthSpike();
  if(e.code==='KeyQ') useAbility(); // Q key to use main ability
});

// Game update loop
function update() {
  // Movement
  if(keys['ArrowLeft']||keys['KeyA']) player.dx=-player.speed;
  else if(keys['ArrowRight']||keys['KeyD']) player.dx=player.speed;
  else player.dx*=0.8;

  if((keys['ArrowUp']||keys['KeyW']||keys['Space']) && player.onGround) {
    player.dy=player.jumpForce; player.onGround=false;
  }
  player.dy+=0.5; // gravity
  player.x+=player.dx; player.y+=player.dy;

  // Platform collision
  player.onGround=false;
  platforms.concat(tempPlatforms).forEach(p=>{
    if(player.x<p.x+p.width && player.x+player.width>p.x &&
       player.y<p.y+p.height && player.y+player.height>p.y){
      if(player.dy>0){ player.y=p.y-player.height; player.dy=0; player.onGround=true; }
      else if(player.dy<0){ player.y=p.y+p.height; player.dy=0; }
    }
  });

  // Boundaries
  if(player.x<0) player.x=0;
  if(player.x+player.width>canvas.width) player.x=canvas.width-player.width;
  if(player.y+player.height>canvas.height){ player.y=canvas.height-player.height; player.dy=0; player.onGround=true; }

  // Temp platforms timer
  tempPlatforms.forEach((p,i)=>{ p.timer--; if(p.timer<=0) tempPlatforms.splice(i,1); });

  // Update spikes
  groundSpikes.forEach((s,i)=>{
    s.x += s.vx; s.y += s.vy; s.timer--;
    if(s.timer<=0 || s.x>canvas.width || s.x<0 || s.y>canvas.height || s.y<0) groundSpikes.splice(i,1);
    if(dummy.alive && s.x<dummy.x+dummy.width && s.x+s.width>dummy.x &&
       s.y<dummy.y+dummy.height && s.y+s.height>dummy.y){
      dummy.health-=15; groundSpikes.splice(i,1);
      if(dummy.health<=0) dummy.alive=false;
    }
  });

  // Fireballs
  fireballs.forEach((f,i)=>{
    f.x += f.vx; f.y += f.vy;
    if(f.x>canvas.width||f.x<0||f.y>canvas.height||f.y<0) fireballs.splice(i,1);
    if(dummy.alive && f.x<f.width+dummy.x && f.x+f.width>dummy.x &&
       f.y<dummy.y+dummy.height && f.y+f.height>dummy.y){
      dummy.health-=10; fireballs.splice(i,1);
      if(dummy.health<=0) dummy.alive=false;
    }
  });

  // Water waves
  waterWaves.forEach((w,i)=>{
    w.x += w.vx; w.y += w.vy;
    if(dummy.alive && w.x<w.width+dummy.x && w.x+w.width>dummy.x &&
       w.y<dummy.y+dummy.height && w.y+w.height>dummy.y){
      dummy.health-=w.damage; waterWaves.splice(i,1);
      if(dummy.health<=0) dummy.alive=false;
    }
    if(w.x>canvas.width||w.x<0||w.y>canvas.height||w.y<0) waterWaves.splice(i,1);
  });

  draw();
  requestAnimationFrame(update);
}

// Drawing
function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // Platforms
  ctx.fillStyle='green'; platforms.forEach(p=>ctx.fillRect(p.x,p.y,p.width,p.height));
  ctx.fillStyle='#654321'; tempPlatforms.forEach(p=>ctx.fillRect(p.x,p.y,p.width,p.height));

  // Player
  ctx.fillStyle=player.color; ctx.fillRect(player.x,player.y,player.width,player.height);

  // Earth spikes
  groundSpikes.forEach(s=>{
    let pulse=Math.sin(Date.now()*0.03+s.x)*5;
    let spikeHeight=s.height+pulse;
    ctx.beginPath();
    ctx.moveTo(s.x,s.y+spikeHeight);
    ctx.lineTo(s.x+s.width/2,s.y);
    ctx.lineTo(s.x+s.width,s.y+spikeHeight);
    ctx.closePath();
    let grad=ctx.createLinearGradient(s.x,s.y,s.x,s.y+spikeHeight);
    grad.addColorStop(0,'#5500ff');
    grad.addColorStop(0.5,'#aa00ff');
    grad.addColorStop(1,'#000000');
    ctx.fillStyle=grad;
    ctx.shadowColor='#aa00ff'; ctx.shadowBlur=10; ctx.fill(); ctx.shadowBlur=0;
  });

  // Fireballs
  ctx.fillStyle='#ff5500'; fireballs.forEach(f=>ctx.fillRect(f.x,f.y,f.width,f.height));

  // Water waves
  ctx.fillStyle='#1e90ff'; waterWaves.forEach(w=>ctx.fillRect(w.x,w.y,w.width,w.height));

  // Dummy
  if(dummy.alive){
    ctx.fillStyle=dummy.color; ctx.fillRect(dummy.x,dummy.y,dummy.width,dummy.height);
    ctx.fillStyle='red'; ctx.fillRect(dummy.x,dummy.y-10,dummy.width*(dummy.health/100),5);
  }
}
</script>
</body>
</html>
